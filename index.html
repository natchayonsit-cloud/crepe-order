<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏õ</title>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
/* ================== BASE ================== */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  padding: 16px;
  background: #f3f4f6;
  font-size: 18px;
  line-height: 1.6;
}

/* ================== SHEET CARD ================== */
.sheet {
  background: #ffffff;
  padding: 20px;
  border-radius: 18px;
  margin-bottom: 22px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

/* ================== TITLES ================== */
h2 {
  margin: 0 0 12px;
  font-size: 26px;
}

.section-title {
  font-size: 20px;
  font-weight: bold;
  margin: 20px 0 12px;
}

/* ================== OPTIONS ================== */
.grid-2 {
  display: grid;
  grid-template-columns: 1fr;
  gap: 14px;
}

.option {
  border: 1px solid #e0e0e0;
  border-radius: 14px;
  padding: 14px 14px;
  font-size: 18px;
  display: flex;
  align-items: center;
  gap: 12px;
  background: #fafafa;
}

/* checkbox / radio ‡πÉ‡∏´‡∏ç‡πà */
.option input {
  transform: scale(1.5);
  accent-color: #06c755;
}

/* ================== BUTTONS ================== */
button {
  width: 100%;
  padding: 18px;
  font-size: 20px;
  border-radius: 16px;
  border: none;
  margin-top: 14px;
}

.btn-add {
  background: #e5e7eb;
}

.btn-remove {
  background: #fee2e2;
}

.btn-submit {
  background: #06c755;
  color: #fff;
  font-weight: bold;
  font-size: 22px;
}

/* ‡πÄ‡∏ß‡πâ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ô‡∏¥‡πâ‡∏ß‡∏ä‡∏ô */
.footer-space {
  height: 30px;
}
</style>
</head>

<body>

<div id="sheets"></div>

<button class="btn-add" onclick="addSheet()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡πà‡∏ô</button>
<button class="btn-remove" onclick="removeSheet()">‚ûñ ‡∏•‡∏ö‡πÅ‡∏ú‡πà‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
<button class="btn-submit" onclick="sendOrder()">üßæ ‡∏™‡∏£‡∏∏‡∏õ & ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
<div class="footer-space"></div>

<script>
const LIFF_ID = "2008739884-92cBWC4G";
const QR_URL = "https://raw.githubusercontent.com/natchayonsit-cloud/crepe-order/main/1766328773945.png";

let sheetCount = 0;

window.onload = async () => {
  await liff.init({ liffId: LIFF_ID });
  addSheet();
};

function addSheet() {
  sheetCount++;
  const div = document.createElement("div");
  div.className = "sheet";
  div.innerHTML = getSheetHTML(sheetCount);
  document.getElementById("sheets").appendChild(div);
}

function removeSheet() {
  if (sheetCount <= 1) {
    alert("‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÅ‡∏ú‡πà‡∏ô");
    return;
  }
  document.getElementById("sheets").lastElementChild.remove();
  sheetCount--;
}

function getSheetHTML(i) {
return `
<h2>ü•û ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i}</h2>

<div class="section-title">‡πÅ‡∏õ‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1)</div>
<div class="grid-2">
<label class="option"><input type="radio" name="flour${i}" value="‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö|20">‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö (20)</label>
<label class="option"><input type="radio" name="flour${i}" value="‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏¥‡πà‡∏°|20">‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏¥‡πà‡∏° (20)</label>
</div>

<div class="section-title">üç´ ‡πÅ‡∏¢‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1‚Äì2)</div>
<div class="grid-2">${jamList(i)}</div>

<div class="section-title">üçå ‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1‚Äì5)</div>
<div class="grid-2">${toppingList(i)}</div>

<div class="section-title">üßÄ ‡∏ã‡∏≠‡∏™ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1‚Äì3)</div>
<div class="grid-2">${sauceList(i)}</div>
`;
}

function jamList(i) {
const jams = [
["‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï",0],["‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ",0],["‡∏ß‡∏ô‡∏¥‡∏•‡∏≤",0],["‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢",0],
["‡∏™‡πâ‡∏°",0],["‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢",0],["‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ",0],["‡∏û‡∏£‡∏¥‡∏Å‡πÄ‡∏ú‡∏≤",0],["‡∏ô‡∏π‡πÄ‡∏ó‡∏•‡∏•‡πà‡∏≤",15]
];
return jams.map(j =>
`<label class="option"><input type="checkbox" name="jam${i}" value="${j[0]}|${j[1]}">${j[0]} ${j[1]?`(+${j[1]})`:""}</label>`
).join("");
}

function toppingList(i) {
const t = [
["‡∏Å‡∏•‡πâ‡∏ß‡∏¢",5],["‡∏•‡∏π‡∏Å‡πÄ‡∏Å‡∏î",5],["‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏•‡∏Å",5],["‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏ô‡∏ä‡πå",5],["‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î",5],
["‡∏ù‡∏≠‡∏¢‡∏ó‡∏≠‡∏á",10],["‡πÄ‡∏°‡πá‡∏î‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á",10],["‡πÄ‡∏¢‡∏•‡∏•‡∏µ‡πà‡πÅ‡∏î‡∏á",10],["‡∏°‡∏≤‡∏£‡πå‡∏ä‡πÄ‡∏°‡∏•‡πÇ‡∏•",10],
["‡∏´‡∏°‡∏π‡∏´‡∏¢‡∏≠‡∏á",10],["‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å",10],["‡∏õ‡∏π‡∏≠‡∏±‡∏î",10],["‡∏ä‡∏µ‡∏™",10],["‡πÑ‡∏Ç‡πà",10],["‡πÅ‡∏Æ‡∏°",10]
];
return t.map(x =>
`<label class="option"><input type="checkbox" name="topping${i}" value="${x[0]}|${x[1]}">${x[0]} (+${x[1]})</label>`
).join("");
}

function sauceList(i) {
const s = ["‡∏ô‡∏°‡∏Ç‡πâ‡∏ô","‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï","‡∏ã‡∏≠‡∏™‡∏û‡∏£‡∏¥‡∏Å","‡∏°‡∏≤‡∏¢‡∏≠‡∏á‡πÄ‡∏ô‡∏™","‡∏ã‡∏≠‡∏™‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®","‡πÑ‡∏°‡πà‡∏£‡∏≤‡∏î‡∏ã‡∏≠‡∏™"];
return s.map(x =>
`<label class="option"><input type="checkbox" name="sauce${i}" value="${x}|0">${x}</label>`
).join("");
}

function parseItem(v) {
const [n,p] = v.split("|");
return {name:n, price:+p};
}

function checkLimit(name, max, label) {
const c = document.querySelectorAll(`input[name="${name}"]:checked`).length;
if (c > max) {
  alert(`${label} ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${max} ‡∏≠‡∏¢‡πà‡∏≤‡∏á`);
  return false;
}
return true;
}

async function sendOrder() {
if (!liff.isInClient()) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE");

let total = 0;
let text = "üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏õ\n";

for (let i=1;i<=sheetCount;i++) {

  if (
    !checkLimit(`jam${i}`,2,"‡πÅ‡∏¢‡∏° (‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà "+i+")") ||
    !checkLimit(`topping${i}`,5,"‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á (‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà "+i+")") ||
    !checkLimit(`sauce${i}`,3,"‡∏ã‡∏≠‡∏™ (‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà "+i+")")
  ) return;

  let flour = document.querySelector(`input[name="flour${i}"]:checked`);
  if (!flour) return alert(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏õ‡πâ‡∏á ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i}`);

  let f = parseItem(flour.value);
  total += f.price;

  let jams=[], tops=[], sauces=[];
  document.querySelectorAll(`input[name="jam${i}"]:checked`).forEach(e=>{
    let x=parseItem(e.value); jams.push(x.name); total+=x.price;
  });
  document.querySelectorAll(`input[name="topping${i}"]:checked`).forEach(e=>{
    let x=parseItem(e.value); tops.push(x.name); total+=x.price;
  });
  document.querySelectorAll(`input[name="sauce${i}"]:checked`).forEach(e=>{
    sauces.push(e.value.split("|")[0]);
  });

  text += `
üçΩ ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i}
ü•û ‡πÅ‡∏õ‡πâ‡∏á: ${f.name}
üç´ ‡πÅ‡∏¢‡∏°: ${jams.join(", ")||"-"}
üçå ‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á: ${tops.join(", ")||"-"}
üßÄ ‡∏ã‡∏≠‡∏™: ${sauces.join(", ")||"-"}
`;
}

text += `
üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total} ‡∏ö‡∏≤‡∏ó

üìå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏î‡∏¢‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
‡∏´‡∏•‡∏±‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏Ñ‡∏£‡∏±‡∏ö üôè
`;

await liff.sendMessages([
  { type: "text", text },
  { type: "image", originalContentUrl: QR_URL, previewImageUrl: QR_URL }
]);

setTimeout(() => {
  liff.closeWindow();
}, 900);
}
</script>

</body>
</html>
