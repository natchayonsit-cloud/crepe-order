<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>à¸ªà¸±à¹ˆà¸‡à¹€à¸„à¸£à¸›</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body { font-family: sans-serif; padding: 16px; }
.sheet {
  border:2px solid #ddd;
  border-radius:10px;
  padding:12px;
  margin-bottom:16px;
}
h2,h3 { margin:8px 0; }
button {
  width:100%;
  padding:14px;
  font-size:16px;
  border:none;
  border-radius:8px;
  background:#06c755;
  color:#fff;
  margin-top:10px;
}
.btn-gray { background:#999; }
#qrBox {
  display:none;
  text-align:center;
  margin-top:20px;
}
#qrBox img {
  max-width:260px;
}
small { color:#666; }
</style>
</head>

<body>

<h1>ğŸ¥ à¸ªà¸±à¹ˆà¸‡à¹€à¸„à¸£à¸›</h1>

<div id="sheets"></div>

<button onclick="addSheet()">â• à¹€à¸à¸´à¹ˆà¸¡à¹à¸œà¹ˆà¸™</button>
<button class="btn-gray" onclick="removeSheet()">â– à¸¥à¸šà¹à¸œà¹ˆà¸™</button>
<button onclick="previewOrder()">ğŸ’³ à¸ªà¸£à¸¸à¸› & à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™</button>

<div id="qrBox">
  <h2>ğŸ“Œ à¸à¸£à¸¸à¸“à¸²à¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™</h2>
  <p id="totalText"></p>
  <img src="https://i.imgur.com/XXXXXXX.jpg" alt="PromptPay QR">
  <!-- â¬†ï¸ à¹ƒà¸ªà¹ˆ URL à¸£à¸¹à¸› QR à¸‚à¸­à¸‡à¸„à¸¸à¸“à¸•à¸£à¸‡à¸™à¸µà¹‰ -->
  <button onclick="sendOrder()">âœ… à¸¢à¸·à¸™à¸¢à¸±à¸™à¸­à¸­à¹€à¸”à¸­à¸£à¹Œ</button>
</div>

<script>
const LIFF_ID = "2008739884-92cBWC4G";
const MAX_SHEET = 4;
let sheetCount = 0;
let finalMessage = "";
let finalTotal = 0;

window.onload = async () => {
  await liff.init({ liffId: LIFF_ID });
  addSheet();
};

const flour = [["à¹à¸›à¹‰à¸‡à¸à¸£à¸­à¸š",20],["à¹à¸›à¹‰à¸‡à¸™à¸´à¹ˆà¸¡",20]];
const jam = [["à¸Šà¹‡à¸­à¸à¹‚à¸à¹à¸¥à¸•",0],["à¸ªà¸•à¸£à¸­à¸§à¹Œà¹€à¸šà¸­à¸£à¹Œà¸£à¸µ",0],["à¸§à¸™à¸´à¸¥à¸²",0],["à¹ƒà¸šà¹€à¸•à¸¢",0],
["à¸ªà¹‰à¸¡",0],["à¸Šà¸²à¹„à¸—à¸¢",0],["à¸šà¸¥à¸¹à¹€à¸šà¸­à¸£à¹Œà¸£à¸µ",0],["à¸à¸£à¸´à¸à¹€à¸œà¸²",0],["à¸™à¸¹à¹€à¸—à¸¥à¸¥à¹ˆà¸²",15]];
const topping = [
["à¸à¸¥à¹‰à¸§à¸¢",5],["à¸„à¸­à¸™à¹€à¸Ÿà¸¥à¸",5],["à¹‚à¸à¹‚à¸à¹‰à¸„à¸£à¸±à¹‰à¸™à¸Šà¹Œ",5],["à¹‚à¸­à¸£à¸´à¹‚à¸­à¹‰à¸šà¸”",5],["à¸¥à¸¹à¸à¹€à¸à¸”",5],
["à¸à¸­à¸¢à¸—à¸­à¸‡",10],["à¹€à¸¡à¹‡à¸”à¸¡à¸°à¸¡à¹ˆà¸§à¸‡",10],["à¹€à¸¢à¸¥à¸¥à¸µà¹ˆà¹à¸”à¸‡",10],["à¸¡à¸²à¸£à¹Œà¸Šà¹€à¸¡à¸¥à¹‚à¸¥",10],
["à¸«à¸¡à¸¹à¸«à¸¢à¸­à¸‡",10],["à¹„à¸ªà¹‰à¸à¸£à¸­à¸",10],["à¸›à¸¹à¸­à¸±à¸”",10],["à¸Šà¸µà¸ª",10],["à¹„à¸‚à¹ˆ",10],["à¹à¸®à¸¡",10]
];
const sauce = [["à¸™à¸¡à¸‚à¹‰à¸™",0],["à¸Šà¹‡à¸­à¸à¹‚à¸à¹à¸¥à¸•",0],["à¸‹à¸­à¸ªà¸à¸£à¸´à¸",0],
["à¸¡à¸²à¸¢à¸­à¸‡à¹€à¸™à¸ª",0],["à¸‹à¸­à¸ªà¸¡à¸°à¹€à¸‚à¸·à¸­à¹€à¸—à¸¨",0],["à¹„à¸¡à¹ˆà¸£à¸²à¸”à¸‹à¸­à¸ª",0]];

function addSheet(){
  if(sheetCount>=MAX_SHEET) return alert("à¸ªà¸¹à¸‡à¸ªà¸¸à¸” 4 à¹à¸œà¹ˆà¸™");
  sheetCount++;
  let n=sheetCount;
  let html=`<div class="sheet" id="sheet${n}">
  <h2>ğŸ“„ à¹à¸œà¹ˆà¸™à¸—à¸µà¹ˆ ${n}</h2>

  <h3>ğŸ¥ à¹à¸›à¹‰à¸‡</h3>
  ${flour.map(f=>`<input type="radio" name="flour${n}" value="${f[0]}|${f[1]}"> ${f[0]} (${f[1]})<br>`).join("")}

  <h3>ğŸ« à¹à¸¢à¸¡ <small>(â‰¤2)</small></h3>
  ${jam.map(j=>`<input type="checkbox" name="jam${n}" value="${j[0]}|${j[1]}"> ${j[0]} ${j[1]?`(+${j[1]})`:""}<br>`).join("")}

  <h3>ğŸŒ à¸—à¹‡à¸­à¸›à¸›à¸´à¹‰à¸‡ <small>(â‰¤5)</small></h3>
  ${topping.map(t=>`<input type="checkbox" name="top${n}" value="${t[0]}|${t[1]}"> ${t[0]} (+${t[1]})<br>`).join("")}

  <h3>ğŸ§€ à¸‹à¸­à¸ª <small>(â‰¤3)</small></h3>
  ${sauce.map(s=>`<input type="checkbox" name="sauce${n}" value="${s[0]}|${s[1]}"> ${s[0]}<br>`).join("")}
  </div>`;
  sheets.insertAdjacentHTML("beforeend",html);
}

function removeSheet(){
  if(sheetCount<=1) return;
  document.getElementById(`sheet${sheetCount}`).remove();
  sheetCount--;
}

function parse(v){let[a,b]=v.split("|");return{name:a,price:+b};}
function checked(n){return document.querySelectorAll(`input[name="${n}"]:checked`);}

function previewOrder(){
  let msg="ğŸ§¾ à¸ªà¸£à¸¸à¸›à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸±à¹ˆà¸‡à¹€à¸„à¸£à¸›\n\n";
  let grand=0;

  for(let i=1;i<=sheetCount;i++){
    let f=document.querySelector(`input[name="flour${i}"]:checked`);
    if(!f) return alert(`à¹€à¸¥à¸·à¸­à¸à¹à¸›à¹‰à¸‡ à¹à¸œà¹ˆà¸™à¸—à¸µà¹ˆ ${i}`);

    if(checked(`jam${i}`).length>2) return alert(`à¹à¸¢à¸¡à¹€à¸à¸´à¸™ 2 (à¹à¸œà¹ˆà¸™ ${i})`);
    if(checked(`top${i}`).length>5) return alert(`à¸—à¹‡à¸­à¸›à¸›à¸´à¹‰à¸‡à¹€à¸à¸´à¸™ 5 (à¹à¸œà¹ˆà¸™ ${i})`);
    if(checked(`sauce${i}`).length>3) return alert(`à¸‹à¸­à¸ªà¹€à¸à¸´à¸™ 3 (à¹à¸œà¹ˆà¸™ ${i})`);

    let sum=0;
    let F=parse(f.value); sum+=F.price;

    let J=[],T=[],S=[];
    checked(`jam${i}`).forEach(e=>{let x=parse(e.value);J.push(x.name);sum+=x.price;});
    checked(`top${i}`).forEach(e=>{let x=parse(e.value);T.push(x.name);sum+=x.price;});
    checked(`sauce${i}`).forEach(e=>S.push(parse(e.value).name));

    grand+=sum;

    msg+=`ğŸ“„ à¹à¸œà¹ˆà¸™à¸—à¸µà¹ˆ ${i}\nğŸ¥ ${F.name}\nğŸ« ${J.join(",")||"-"}\nğŸŒ ${T.join(",")||"-"}\nğŸ§€ ${S.join(",")||"-"}\nğŸ’° ${sum} à¸šà¸²à¸—\n\n`;
  }

  msg+=`ğŸ’³ à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸” ${grand} à¸šà¸²à¸—`;
  finalMessage=msg;
  finalTotal=grand;

  document.getElementById("totalText").innerText=`à¸¢à¸­à¸”à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸Šà¸³à¸£à¸° ${grand} à¸šà¸²à¸—`;
  document.getElementById("qrBox").style.display="block";
}

async function sendOrder(){
  await liff.sendMessages([{type:"text",text:finalMessage+"\nğŸ“Œ à¸Šà¸³à¸£à¸°à¹à¸¥à¹‰à¸§ à¸à¸£à¸¸à¸“à¸²à¸£à¸­à¸£à¹‰à¸²à¸™à¸¢à¸·à¸™à¸¢à¸±à¸™à¸„à¸£à¸±à¸š"}]);
  liff.closeWindow();
}
</script>

</body>
</html>
