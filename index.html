<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏õ</title>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body { font-family: sans-serif; padding: 16px; }
h2, h3 { margin-top: 16px; }
.sheet {
  border: 2px solid #ddd;
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 20px;
}
button {
  padding: 12px;
  font-size: 16px;
  width: 100%;
  background: #06c755;
  color: #fff;
  border: none;
  border-radius: 8px;
  margin-top: 10px;
}
.btn-gray {
  background:#999;
}
small { color:#666; }
</style>
</head>

<body>

<h1>ü•û ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏õ</h1>

<div id="sheets"></div>

<button onclick="addSheet()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡πà‡∏ô</button>
<button class="btn-gray" onclick="removeSheet()">‚ûñ ‡∏•‡∏ö‡πÅ‡∏ú‡πà‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
<button onclick="sendOrder()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏õ</button>

<script>
const LIFF_ID = "2008739884-92cBWC4G";
const MAX_SHEET = 4;
let sheetCount = 0;

window.onload = async () => {
  await liff.init({ liffId: LIFF_ID });
  addSheet(); // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà 1
};

// ---------- ‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏•‡∏≤‡∏á ----------
const flourList = [
  ["‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö",20],
  ["‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏¥‡πà‡∏°",20]
];

const jamList = [
  ["‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï",0],["‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ",0],["‡∏ß‡∏ô‡∏¥‡∏•‡∏≤",0],["‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢",0],
  ["‡∏™‡πâ‡∏°",0],["‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢",0],["‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ",0],["‡∏û‡∏£‡∏¥‡∏Å‡πÄ‡∏ú‡∏≤",0],
  ["‡∏ô‡∏π‡πÄ‡∏ó‡∏•‡∏•‡πà‡∏≤",15]
];

const toppingList = [
  ["‡∏Å‡∏•‡πâ‡∏ß‡∏¢",5],["‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏•‡∏Å",5],["‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏ô‡∏ä‡πå",5],["‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î",5],["‡∏•‡∏π‡∏Å‡πÄ‡∏Å‡∏î",5],
  ["‡∏ù‡∏≠‡∏¢‡∏ó‡∏≠‡∏á",10],["‡πÄ‡∏°‡πá‡∏î‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á",10],["‡πÄ‡∏¢‡∏•‡∏•‡∏µ‡πà‡πÅ‡∏î‡∏á",10],["‡∏°‡∏≤‡∏£‡πå‡∏ä‡πÄ‡∏°‡∏•‡πÇ‡∏•",10],
  ["‡∏´‡∏°‡∏π‡∏´‡∏¢‡∏≠‡∏á",10],["‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å",10],["‡∏õ‡∏π‡∏≠‡∏±‡∏î",10],["‡∏ä‡∏µ‡∏™",10],["‡πÑ‡∏Ç‡πà",10],["‡πÅ‡∏Æ‡∏°",10]
];

const sauceList = [
  ["‡∏ô‡∏°‡∏Ç‡πâ‡∏ô",0],["‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï",0],["‡∏ã‡∏≠‡∏™‡∏û‡∏£‡∏¥‡∏Å",0],
  ["‡∏°‡∏≤‡∏¢‡∏≠‡∏á‡πÄ‡∏ô‡∏™",0],["‡∏ã‡∏≠‡∏™‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®",0],["‡πÑ‡∏°‡πà‡∏£‡∏≤‡∏î‡∏ã‡∏≠‡∏™",0]
];

// ---------- UI ----------
function addSheet() {
  if (sheetCount >= MAX_SHEET) return alert("‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 4 ‡πÅ‡∏ú‡πà‡∏ô");
  sheetCount++;
  renderSheet(sheetCount);
}

function removeSheet() {
  if (sheetCount <= 1) return;
  document.getElementById(`sheet${sheetCount}`).remove();
  sheetCount--;
}

function renderSheet(n) {
  let html = `
  <div class="sheet" id="sheet${n}">
    <h2>üìÑ ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${n}</h2>

    <h3>ü•û ‡πÅ‡∏õ‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1)</h3>
    ${flourList.map(f=>`<label><input type="radio" name="flour${n}" value="${f[0]}|${f[1]}"> ${f[0]} (${f[1]})</label><br>`).join("")}

    <h3>üç´ ‡πÅ‡∏¢‡∏° <small>(‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2)</small></h3>
    ${jamList.map(j=>`<label><input type="checkbox" name="jam${n}" value="${j[0]}|${j[1]}"> ${j[0]}${j[1]?` (+${j[1]})`:""}</label><br>`).join("")}

    <h3>üçå ‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á <small>(‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5)</small></h3>
    ${toppingList.map(t=>`<label><input type="checkbox" name="topping${n}" value="${t[0]}|${t[1]}"> ${t[0]} (+${t[1]})</label><br>`).join("")}

    <h3>üßÄ ‡∏ã‡∏≠‡∏™ <small>(‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3)</small></h3>
    ${sauceList.map(s=>`<label><input type="checkbox" name="sauce${n}" value="${s[0]}|${s[1]}"> ${s[0]}</label><br>`).join("")}
  </div>`;
  document.getElementById("sheets").insertAdjacentHTML("beforeend", html);
}

// ---------- Logic ----------
function parse(v){ let [n,p]=v.split("|"); return {n, p:+p}; }
function checked(name){ return document.querySelectorAll(`input[name="${name}"]:checked`); }

async function sendOrder() {
  if (!liff.isInClient()) return alert("‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô");

  let msg = "üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏õ\n\n";
  let grandTotal = 0;

  for (let i=1;i<=sheetCount;i++) {
    let flour = document.querySelector(`input[name="flour${i}"]:checked`);
    if (!flour) return alert(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏õ‡πâ‡∏á ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i}`);

    if (checked(`jam${i}`).length>2) return alert(`‡πÅ‡∏¢‡∏° ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i} ‡πÄ‡∏Å‡∏¥‡∏ô 2`);
    if (checked(`topping${i}`).length>5) return alert(`‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i} ‡πÄ‡∏Å‡∏¥‡∏ô 5`);
    if (checked(`sauce${i}`).length>3) return alert(`‡∏ã‡∏≠‡∏™ ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i} ‡πÄ‡∏Å‡∏¥‡∏ô 3`);

    let total=0;
    let f=parse(flour.value); total+=f.p;

    let jams=[], tops=[], sauces=[];
    checked(`jam${i}`).forEach(e=>{let x=parse(e.value); jams.push(x.n); total+=x.p;});
    checked(`topping${i}`).forEach(e=>{let x=parse(e.value); tops.push(x.n); total+=x.p;});
    checked(`sauce${i}`).forEach(e=>{sauces.push(parse(e.value).n);});

    grandTotal+=total;

    msg+=`üìÑ ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i}\n`;
    msg+=`ü•û ‡πÅ‡∏õ‡πâ‡∏á: ${f.n}\n`;
    msg+=`üç´ ‡πÅ‡∏¢‡∏°: ${jams.join(", ")||"-"}\n`;
    msg+=`üçå ‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á: ${tops.join(", ")||"-"}\n`;
    msg+=`üßÄ ‡∏ã‡∏≠‡∏™: ${sauces.join(", ")||"-"}\n`;
    msg+=`üí∞ ‡∏£‡∏ß‡∏°: ${total} ‡∏ö‡∏≤‡∏ó\n\n`;
  }

  msg+=`üí≥ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${grandTotal} ‡∏ö‡∏≤‡∏ó\nüìå ‡∏ó‡∏≤‡∏á‡∏£‡πâ‡∏≤‡∏ô‡∏à‡∏∞‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö`;

  await liff.sendMessages([{type:"text", text:msg}]);
  liff.closeWindow();
}
</script>

</body>
</html>
