<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏õ</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
/* ===== BASE ===== */
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  padding:20px;
  background:#f2f3f5;
  font-size:26px;
  line-height:1.9;
}

/* ===== CARD ===== */
.sheet{
  background:#fff;
  padding:26px;
  border-radius:24px;
  margin-bottom:30px;
  box-shadow:0 6px 14px rgba(0,0,0,.12);
}
h2{
  font-size:40px;
  margin:0 0 20px;
}
.section-title{
  font-size:32px;
  font-weight:bold;
  margin:30px 0 18px;
}

/* ===== GRID ===== */
.grid-2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:22px;
}

/* ===== OPTION ===== */
.option{
  border:2px solid #e0e0e0;
  border-radius:22px;
  padding:22px 20px;
  font-size:28px;
  display:flex;
  align-items:center;
  gap:20px;
  background:#fafafa;
}
.option input{
  transform:scale(2.2);
  accent-color:#06c755;
}

/* ===== STICKY BAR ===== */
.sticky-bar{
  position:fixed;
  left:0;right:0;bottom:0;
  background:#fff;
  padding:18px 20px 22px;
  box-shadow:0 -6px 16px rgba(0,0,0,.2);
  z-index:999;
}
.total-box{
  font-size:34px;
  font-weight:bold;
  text-align:center;
  margin-bottom:14px;
}
button{
  width:100%;
  padding:26px;
  font-size:30px;
  border-radius:26px;
  border:none;
  margin-bottom:12px;
}
.btn-add{background:#2563eb;color:#fff;font-weight:bold}
.btn-random{background:#f59e0b;color:#fff;font-weight:bold}
.btn-submit{background:#06c755;color:#fff;font-weight:bold}

/* ===== POPUP ===== */
.popup-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
}
.popup{
  background:#fff;
  padding:30px;
  border-radius:26px;
  width:90%;
  max-width:420px;
  text-align:center;
}
.popup h3{
  font-size:34px;
  margin-bottom:20px;
}
.popup p{
  font-size:26px;
  margin-bottom:24px;
}
.popup button{
  background:#06c755;
  color:#fff;
  font-size:30px;
}
</style>
</head>

<body>

<!-- ===== ORDER ===== -->
<div id="sheets"></div>

<div class="sticky-bar" id="stickyBar">
  <div class="total-box">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</div>
  <button class="btn-add" onclick="addSheet()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡πà‡∏ô</button>
  <button class="btn-random" onclick="randomMenu()">üé≤ ‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏∏‡πà‡∏° (‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö)</button>
  <button class="btn-submit" onclick="sendOrder()">üßæ ‡∏™‡∏£‡∏∏‡∏õ & ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
</div>

<!-- ===== POPUP ===== -->
<div class="popup-bg" id="popup">
  <div class="popup">
    <h3>‚ö†Ô∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
    <p id="popupText"></p>
    <button onclick="closePopup()">‡∏ï‡∏Å‡∏•‡∏á</button>
  </div>
</div>

<script>
const LIFF_ID="2008739884-92cBWC4G";
const QR_URL="https://raw.githubusercontent.com/natchayonsit-cloud/crepe-order/main/1766328773945.png";

let sheetCount=0;

/* ===== INIT ===== */
window.onload=async()=>{
  await liff.init({liffId:LIFF_ID});
  addSheet();
  adjustSafeArea();
  document.body.addEventListener("change",calcTotal);
};

/* ===== SAFE AREA ===== */
function adjustSafeArea(){
  document.body.style.paddingBottom =
    document.getElementById("stickyBar").offsetHeight + 40 + "px";
}
window.addEventListener("resize",adjustSafeArea);

/* ===== POPUP ===== */
function showPopup(msg){
  popupText.textContent = msg;
  popup.style.display="flex";
}
function closePopup(){
  popup.style.display="none";
}

/* ===== LIMIT ===== */
function checkLimit(name,max,label){
  const c=document.querySelectorAll(`input[name="${name}"]:checked`).length;
  if(c>max){
    showPopup(`${label} ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô ${max} ‡∏≠‡∏¢‡πà‡∏≤‡∏á`);
    return false;
  }
  return true;
}

/* ===== SHEET ===== */
function addSheet(){
  sheetCount++;

  const d = document.createElement("div");
  d.className = "sheet";
  d.id = "sheet" + sheetCount;   // ‡πÉ‡∏´‡πâ‡∏°‡∏µ id ‡πÑ‡∏ß‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏≤
  d.innerHTML = getSheetHTML(sheetCount);

  sheets.appendChild(d);

  // ‚¨áÔ∏è ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÅ‡∏ú‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà
  setTimeout(()=>{
    document.getElementById("sheet"+sheetCount)
      .scrollIntoView({behavior:"smooth"});
  },100);
}


/* ===== RANDOM MENU ===== */
function randomMenu(){
  const i = sheetCount;

  document.querySelector(`input[name="flour${i}"][value="‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö|20"]`).checked = true;

  document.querySelectorAll(`input[name="jam${i}"]`).forEach(x=>x.checked=false);
  document.querySelectorAll(`input[name="topping${i}"]`).forEach(x=>x.checked=false);
  document.querySelectorAll(`input[name="sauce${i}"]`).forEach(x=>x.checked=false);

  [...document.querySelectorAll(`input[name="jam${i}"]`)]
    .sort(()=>0.5-Math.random()).slice(0,2).forEach(x=>x.checked=true);

  [...document.querySelectorAll(`input[name="topping${i}"]`)]
    .sort(()=>0.5-Math.random()).slice(0,Math.floor(Math.random()*5)+1)
    .forEach(x=>x.checked=true);

  [...document.querySelectorAll(`input[name="sauce${i}"]`)]
    .filter(x=>!x.value.startsWith("‡πÑ‡∏°‡πà‡∏£‡∏≤‡∏î"))
    .sort(()=>0.5-Math.random()).slice(0,2)
    .forEach(x=>x.checked=true);

  calcTotal();
  showPopup("üé≤ ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß");
}

/* ===== TOTAL ===== */
function calcTotal(){
  let t=0;
  document.querySelectorAll("input:checked").forEach(e=>{
    const p=+e.value.split("|")[1];
    if(!isNaN(p)) t+=p;
  });
  total.textContent=t;
}

/* ===== MENU DATA ===== */
function getSheetHTML(i){
return `
<h2>ü•û ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i}</h2>

<div class="section-title">‡πÅ‡∏õ‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1)</div>
<div class="grid-2">
<label class="option"><input type="radio" name="flour${i}" value="‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö|20">‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö (20)</label>
<label class="option"><input type="radio" name="flour${i}" value="‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏¥‡πà‡∏°|20">‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏¥‡πà‡∏° (20)</label>
</div>

<div class="section-title">üç´ ‡πÅ‡∏¢‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1‚Äì2)</div>
<div class="grid-2">${jamList(i)}</div>

<div class="section-title">üçå ‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1‚Äì5)</div>
<div class="grid-2">${toppingList(i)}</div>

<div class="section-title">üßÄ ‡∏ã‡∏≠‡∏™ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1‚Äì3)</div>
<div class="grid-2">${sauceList(i)}</div>
`;
}

function jamList(i){
const jams=[
["‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï",0],["‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ",0],["‡∏ß‡∏ô‡∏¥‡∏•‡∏≤",0],["‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢",0],
["‡∏™‡πâ‡∏°",0],["‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢",0],["‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ",0],["‡∏û‡∏£‡∏¥‡∏Å‡πÄ‡∏ú‡∏≤",0],["‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤",5],["‡∏ô‡∏π‡πÄ‡∏ó‡∏•‡∏•‡πà‡∏≤",15]
];
return jams.map(j=>`
<label class="option">
<input type="checkbox" name="jam${i}" value="${j[0]}|${j[1]}">
${j[0]} ${j[1]>0?`(+${j[1]})`:""}
</label>`).join("");
}

function toppingList(i){
const t=[
["‡∏Å‡∏•‡πâ‡∏ß‡∏¢",10],["‡∏•‡∏π‡∏Å‡πÄ‡∏Å‡∏î",10],["‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏•‡∏Å",5],["‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏ô‡∏ä‡πå",5],["‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î",5],["‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏´‡∏•‡∏≤‡∏Å‡∏™‡∏µ",5],
["‡∏ù‡∏≠‡∏¢‡∏ó‡∏≠‡∏á",10],["‡πÄ‡∏°‡πá‡∏î‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á",10],["‡πÄ‡∏¢‡∏•‡∏•‡∏µ‡πà‡πÅ‡∏î‡∏á",10],["‡∏°‡∏≤‡∏£‡πå‡∏ä‡πÄ‡∏°‡∏•‡πÇ‡∏•",10],
["‡∏´‡∏°‡∏π‡∏´‡∏¢‡∏≠‡∏á",10],["‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å",10],["‡∏õ‡∏π‡∏≠‡∏±‡∏î",10],["‡∏ä‡∏µ‡∏™",10],["‡πÑ‡∏Ç‡πà",10],["‡πÅ‡∏Æ‡∏°",10],["‡πÑ‡∏Ç‡πà‡∏Å‡∏∏‡πâ‡∏á",15],["‡∏¢‡∏≥‡∏™‡∏≤‡∏´‡∏£‡πà‡∏≤‡∏¢",15],["‡∏™‡∏≤‡∏´‡∏£‡πà‡∏≤‡∏¢‡∏¢‡πà‡∏≤‡∏á",10]
];
return t.map(x=>`
<label class="option">
<input type="checkbox" name="topping${i}" value="${x[0]}|${x[1]}">
${x[0]} (+${x[1]})
</label>`).join("");
}

function sauceList(i){
const s=[
  ["‡∏ô‡∏°‡∏Ç‡πâ‡∏ô",0],
  ["‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï",0],
  ["‡∏ã‡∏≠‡∏™‡∏û‡∏£‡∏¥‡∏Å",0],
  ["‡∏°‡∏≤‡∏¢‡∏≠‡∏á‡πÄ‡∏ô‡∏™",0],
  ["‡∏ã‡∏≠‡∏™‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®",0],
  ["‡∏ó‡∏≤‡πÇ‡∏Å‡∏∞‡∏¢‡∏≤‡∏Å‡∏¥",0],
  ["‡∏ô‡πâ‡∏≥‡∏™‡∏•‡∏±‡∏î",5],
  ["‡πÑ‡∏°‡πà‡∏£‡∏≤‡∏î‡∏ã‡∏≠‡∏™",0]
];

return s.map(x=>`
<label class="option">
<input type="checkbox" name="sauce${i}" value="${x[0]}|${x[1]}">
${x[0]} ${x[1]>0?`(+${x[1]})`:""}
</label>`).join("");
}


/* ===== SEND ORDER ===== */
async function sendOrder(){
  if(!liff.isInClient()){showPopup("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE");return}

  let totalPrice=0;
  let text="üßæ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏õ\n";

  for(let i=1;i<=sheetCount;i++){
    if(
      !checkLimit(`jam${i}`,2,"‡πÅ‡∏¢‡∏°") ||
      !checkLimit(`topping${i}`,5,"‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á") ||
      !checkLimit(`sauce${i}`,3,"‡∏ã‡∏≠‡∏™")
    ) return;

    const flour=document.querySelector(`input[name="flour${i}"]:checked`);
    if(!flour){showPopup(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏õ‡πâ‡∏á ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i}`);return}

    const [fname,fprice]=flour.value.split("|");
    totalPrice+=+fprice;

    let jams=[],tops=[],sauces=[];
    document.querySelectorAll(`input[name="jam${i}"]:checked`).forEach(e=>{
      const [n,p]=e.value.split("|");jams.push(n);totalPrice+=+p;
    });
    document.querySelectorAll(`input[name="topping${i}"]:checked`).forEach(e=>{
      const [n,p]=e.value.split("|");tops.push(n);totalPrice+=+p;
    });
    document.querySelectorAll(`input[name="sauce${i}"]:checked`).forEach(e=>{
      sauces.push(e.value.split("|")[0]);
    });

    text+=`
üçΩ ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i}
ü•û ‡πÅ‡∏õ‡πâ‡∏á: ${fname}
üç´ ‡πÅ‡∏¢‡∏°: ${jams.join(", ")||"-"}
üçå ‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á: ${tops.join(", ")||"-"}
üßÄ ‡∏ã‡∏≠‡∏™: ${sauces.join(", ")||"-"}
`;
  }

  text+=`
üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${totalPrice} ‡∏ö‡∏≤‡∏ó
üìå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏î‡∏¢‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
`;

  await liff.sendMessages([
    {type:"text",text},
    {type:"image",originalContentUrl:QR_URL,previewImageUrl:QR_URL}
  ]);

  setTimeout(()=>liff.closeWindow(),900);
}
</script>

</body>
</html>




