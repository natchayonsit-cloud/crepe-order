<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏™‡∏±‡πà‡∏á‡πÄ‡∏Ñ‡∏£‡∏õ</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  padding:20px;
  padding-bottom:340px;
  background:#f2f3f5;
  font-size:26px;
  line-height:1.9;
}
.sheet{
  background:#fff;
  padding:26px;
  border-radius:24px;
  margin-bottom:30px;
  box-shadow:0 6px 14px rgba(0,0,0,.12);
}
h2{font-size:40px;margin:0 0 20px}
.section-title{
  font-size:32px;
  font-weight:bold;
  margin:30px 0 18px;
}
.grid-2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:22px;
}
.option{
  border:2px solid #e0e0e0;
  border-radius:22px;
  padding:22px 20px;
  font-size:28px;
  display:flex;
  align-items:center;
  gap:20px;
  background:#fafafa;
}
.option input{
  transform:scale(2.2);
  accent-color:#06c755;
}

/* ===== STICKY BAR ===== */
.sticky-bar{
  position:fixed;
  left:0;right:0;bottom:0;
  background:#fff;
  padding:18px 20px 22px;
  box-shadow:0 -6px 16px rgba(0,0,0,.2);
  z-index:999;
}
.total-box{
  font-size:34px;
  font-weight:bold;
  text-align:center;
  margin-bottom:14px;
}
button{
  width:100%;
  padding:26px;
  font-size:30px;
  border-radius:26px;
  border:none;
  margin-bottom:12px;
}
.btn-add{background:#2563eb;color:#fff;font-weight:bold}
.btn-random{background:#f59e0b;color:#fff;font-weight:bold}
.btn-submit{background:#06c755;color:#fff;font-weight:bold}

/* ===== POPUP ===== */
.popup-bg{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
}
.popup{
  background:#fff;
  padding:30px;
  border-radius:26px;
  width:90%;
  max-width:420px;
  text-align:center;
}
.popup h3{font-size:34px;margin-bottom:20px}
.popup p{font-size:26px;margin-bottom:24px}
.popup button{
  background:#06c755;
  color:#fff;
  font-size:30px;
}
</style>
</head>

<body>

<div id="sheets"></div>

<!-- STICKY -->
<div class="sticky-bar">
  <div class="total-box">üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</div>
  <button class="btn-add" onclick="addSheet()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡πà‡∏ô</button>
  <button class="btn-random" onclick="randomMenu()">üé≤ ‡πÄ‡∏°‡∏ô‡∏π‡∏™‡∏∏‡πà‡∏°</button>
  <button class="btn-submit" onclick="sendOrder()">üßæ ‡∏™‡∏£‡∏∏‡∏õ & ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</button>
</div>

<!-- POPUP -->
<div class="popup-bg" id="popup">
  <div class="popup">
    <h3>‚ÑπÔ∏è ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
    <p id="popupText"></p>
    <button onclick="closePopup()">‡∏ï‡∏Å‡∏•‡∏á</button>
  </div>
</div>

<script>
const LIFF_ID="2008739884-92cBWC4G";
const QR_URL="https://raw.githubusercontent.com/natchayonsit-cloud/crepe-order/main/1766328773945.png";

let sheetCount=0;
let usedRandom=new Set();

window.onload=async()=>{
  await liff.init({liffId:LIFF_ID});
  addSheet();
  document.body.addEventListener("change",calcTotal);
};

function showPopup(msg){
  popupText.textContent=msg;
  popup.style.display="flex";
}
function closePopup(){ popup.style.display="none"; }

function addSheet(){
  sheetCount++;
  const d=document.createElement("div");
  d.className="sheet";
  d.innerHTML=getSheetHTML(sheetCount);
  sheets.appendChild(d);
}

/* ===== RANDOM SMART ===== */
function randomMenu(){
  const i=sheetCount;

  const flour=["‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö|20","‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏¥‡πà‡∏°|20"];
  const jams=[
    "‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï|0","‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ|0","‡∏ß‡∏ô‡∏¥‡∏•‡∏≤|0","‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢|0",
    "‡∏™‡πâ‡∏°|0","‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢|0","‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ|0","‡∏û‡∏£‡∏¥‡∏Å‡πÄ‡∏ú‡∏≤|0","‡∏ô‡∏π‡πÄ‡∏ó‡∏•‡∏•‡πà‡∏≤|15"
  ];
  const toppings=[
    "‡∏Å‡∏•‡πâ‡∏ß‡∏¢|5","‡∏•‡∏π‡∏Å‡πÄ‡∏Å‡∏î|5","‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏•‡∏Å|5","‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏ô‡∏ä‡πå|5","‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î|5",
    "‡∏ù‡∏≠‡∏¢‡∏ó‡∏≠‡∏á|10","‡πÄ‡∏°‡πá‡∏î‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á|10","‡πÄ‡∏¢‡∏•‡∏•‡∏µ‡πà‡πÅ‡∏î‡∏á|10","‡∏°‡∏≤‡∏£‡πå‡∏ä‡πÄ‡∏°‡∏•‡πÇ‡∏•|10",
    "‡∏´‡∏°‡∏π‡∏´‡∏¢‡∏≠‡∏á|10","‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å|10","‡∏õ‡∏π‡∏≠‡∏±‡∏î|10","‡∏ä‡∏µ‡∏™|10","‡πÑ‡∏Ç‡πà|10","‡πÅ‡∏Æ‡∏°|10"
  ];
  const sauces=[
    "‡∏ô‡∏°‡∏Ç‡πâ‡∏ô|0","‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï|0","‡∏ã‡∏≠‡∏™‡∏û‡∏£‡∏¥‡∏Å|0","‡∏°‡∏≤‡∏¢‡∏≠‡∏á‡πÄ‡∏ô‡∏™|0","‡∏ã‡∏≠‡∏™‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®|0","‡πÑ‡∏°‡πà‡∏£‡∏≤‡∏î‡∏ã‡∏≠‡∏™|0"
  ];

  let key,tries=0;
  do{
    const f=pick(flour);
    const j=pick(jams);
    const s=pick(sauces);
    const count=Math.floor(Math.random()*5)+1; // 1‚Äì5 ‡∏ó‡πá‡∏≠‡∏õ
    const tops=shuffle([...toppings]).slice(0,count);

    key=f+j+tops.join()+s;
    if(!usedRandom.has(key)){
      usedRandom.add(key);
      applyRandom(i,f,j,tops,s);
      calcTotal();
      showPopup("üé≤ ‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÉ‡∏´‡πâ‡∏≠‡∏£‡πà‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!");
      return;
    }
    tries++;
  }while(tries<100);

  usedRandom.clear();
  showPopup("‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å üéâ");
}

function applyRandom(i,f,j,tops,s){
  document.querySelectorAll(`input[name="flour${i}"]`).forEach(x=>x.checked=false);
  document.querySelector(`input[name="flour${i}"][value="${f}"]`).checked=true;

  document.querySelectorAll(`input[name="jam${i}"]`).forEach(x=>x.checked=false);
  document.querySelector(`input[name="jam${i}"][value="${j}"]`).checked=true;

  document.querySelectorAll(`input[name="topping${i}"]`).forEach(x=>x.checked=false);
  tops.forEach(t=>{
    document.querySelector(`input[name="topping${i}"][value="${t}"]`).checked=true;
  });

  document.querySelectorAll(`input[name="sauce${i}"]`).forEach(x=>x.checked=false);
  document.querySelector(`input[name="sauce${i}"][value="${s}"]`).checked=true;
}

function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function shuffle(a){ return a.sort(()=>Math.random()-0.5); }

/* ===== TOTAL ===== */
function calcTotal(){
  let t=0;
  document.querySelectorAll("input:checked").forEach(e=>{
    const p=+e.value.split("|")[1];
    if(!isNaN(p))t+=p;
  });
  total.textContent=t;
}

/* ===== DATA ===== */
function getSheetHTML(i){
return `
<h2>ü•û ‡πÅ‡∏ú‡πà‡∏ô‡∏ó‡∏µ‡πà ${i}</h2>

<div class="section-title">‡πÅ‡∏õ‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å 1)</div>
<div class="grid-2">
<label class="option"><input type="radio" name="flour${i}" value="‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö|20">‡πÅ‡∏õ‡πâ‡∏á‡∏Å‡∏£‡∏≠‡∏ö (20)</label>
<label class="option"><input type="radio" name="flour${i}" value="‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏¥‡πà‡∏°|20">‡πÅ‡∏õ‡πâ‡∏á‡∏ô‡∏¥‡πà‡∏° (20)</label>
</div>

<div class="section-title">üç´ ‡πÅ‡∏¢‡∏° (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1‚Äì2)</div>
<div class="grid-2">${jamList(i)}</div>

<div class="section-title">üçå ‡∏ó‡πá‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1‚Äì5)</div>
<div class="grid-2">${toppingList(i)}</div>

<div class="section-title">üßÄ ‡∏ã‡∏≠‡∏™ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ 1‚Äì3)</div>
<div class="grid-2">${sauceList(i)}</div>
`;
}

function jamList(i){
const jams=[
["‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï",0],["‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ",0],["‡∏ß‡∏ô‡∏¥‡∏•‡∏≤",0],["‡πÉ‡∏ö‡πÄ‡∏ï‡∏¢",0],
["‡∏™‡πâ‡∏°",0],["‡∏ä‡∏≤‡πÑ‡∏ó‡∏¢",0],["‡∏ö‡∏•‡∏π‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ",0],["‡∏û‡∏£‡∏¥‡∏Å‡πÄ‡∏ú‡∏≤",0],["‡∏ô‡∏π‡πÄ‡∏ó‡∏•‡∏•‡πà‡∏≤",15]
];
return jams.map(j=>`<label class="option"><input type="checkbox" name="jam${i}" value="${j[0]}|${j[1]}">${j[0]}</label>`).join("");
}
function toppingList(i){
const t=[
["‡∏Å‡∏•‡πâ‡∏ß‡∏¢",5],["‡∏•‡∏π‡∏Å‡πÄ‡∏Å‡∏î",5],["‡∏Ñ‡∏≠‡∏ô‡πÄ‡∏ü‡∏•‡∏Å",5],["‡πÇ‡∏Å‡πÇ‡∏Å‡πâ‡∏Ñ‡∏£‡∏±‡πâ‡∏ô‡∏ä‡πå",5],["‡πÇ‡∏≠‡∏£‡∏¥‡πÇ‡∏≠‡πâ‡∏ö‡∏î",5],
["‡∏ù‡∏≠‡∏¢‡∏ó‡∏≠‡∏á",10],["‡πÄ‡∏°‡πá‡∏î‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á",10],["‡πÄ‡∏¢‡∏•‡∏•‡∏µ‡πà‡πÅ‡∏î‡∏á",10],["‡∏°‡∏≤‡∏£‡πå‡∏ä‡πÄ‡∏°‡∏•‡πÇ‡∏•",10],
["‡∏´‡∏°‡∏π‡∏´‡∏¢‡∏≠‡∏á",10],["‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏Å",10],["‡∏õ‡∏π‡∏≠‡∏±‡∏î",10],["‡∏ä‡∏µ‡∏™",10],["‡πÑ‡∏Ç‡πà",10],["‡πÅ‡∏Æ‡∏°",10]
];
return t.map(x=>`<label class="option"><input type="checkbox" name="topping${i}" value="${x[0]}|${x[1]}">${x[0]} (+${x[1]})</label>`).join("");
}
function sauceList(i){
const s=["‡∏ô‡∏°‡∏Ç‡πâ‡∏ô","‡∏ä‡πá‡∏≠‡∏Å‡πÇ‡∏Å‡πÅ‡∏•‡∏ï","‡∏ã‡∏≠‡∏™‡∏û‡∏£‡∏¥‡∏Å","‡∏°‡∏≤‡∏¢‡∏≠‡∏á‡πÄ‡∏ô‡∏™","‡∏ã‡∏≠‡∏™‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®","‡πÑ‡∏°‡πà‡∏£‡∏≤‡∏î‡∏ã‡∏≠‡∏™"];
return s.map(x=>`<label class="option"><input type="checkbox" name="sauce${i}" value="${x}|0">${x}</label>`).join("");
}

/* ===== SEND ORDER ===== */
async function sendOrder(){
  if(!liff.isInClient()){showPopup("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô LINE");return}
  await liff.sendMessages([
    {type:"text",text:"üßæ ‡∏£‡∏±‡∏ö‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"},
    {type:"image",originalContentUrl:QR_URL,previewImageUrl:QR_URL}
  ]);
  setTimeout(()=>liff.closeWindow(),900);
}
</script>

</body>
</html>

